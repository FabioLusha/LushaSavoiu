\section{Purpose}
\label{sec:purpose}%
Widespread electrification of transport is the most efficient way to reach Europe’s climate objectives for the sector and electric charging is the main asset to overcome the obstacles of the take-up of electric vehicles (EVs). EVs can reduce CO2 by an estimated annual 600,000 tons by 2030, going towards a carbon neutral Europe, and the importance of this aim raises the problem of having efficient systems that manage the charging services. The eMall is thought as an all-encompassing application that oversees the entire process from the user interaction to the effective recharge of the EV's battery.

The main goal we want to achieve with the eMall software is to help The EVDs (electric vehicle drivers) to have better access to recharge and to be able to book a charging point in order to avoid interference with his daily plans. Another important purpose of the system is to safeguard not only the users but also the providers of the service and this is made through privacy agreements and the actual interaction, that guarantees to supervise both interested parts, in order to get the best possible service and pay for it accordingly, having also a technical and economic exploitation of the charging infrastructures.

In this context there is an increase in the requested electric energy, but large amounts of power in short periods would require investments in the reinforcement of the distribution networks, which have not been designed to accommodate such load. It becomes necessary to introduce new systems and solutions to optimize the operation of the distribution networks. In this context we can identify the DSOs as the suppliers of electricity through the distribution networks. The DSOs interact with the eMall, and in particular with the CPMS (Charging Point Management System) module of the system to be. The CPMS, then, gives the information about the DSO's supply to the CPOs, which are important actors, that use the system in order to manage the charging service. A CPO is represented by an employee or a software, part of the business that owns some charging stations and wants to manage them through the eMall, deciding from where to acquire energy, and how to establish the prices, the special offers and other details about the stations.

The eMall is thought as a software that manages both the interaction with the businesses that offer the charging service and the interaction with the EVDs which want to use these services in order to charge their EVs. Therefore, the eMall provides a mobile application (eMma), which through its interface allows to the EVD to obtain the service, and provides, also, a web application that the CPOs use to manage the charging stations. The EVD interacts, as well, with the charging point interface (eMci), that communicates with the CPMS part of the eMall, in order to start the charging session from the station, plugging then the car to the compatible connector to effectively charge the EV.

\paragraph{Goals} In the following table we present the main goals of the software to be. The goals capture the needs of the stakeholders, which are the EVDs and the CPOs.

\newcounter{gc}
\setcounter{gc}{1}
\newcommand{\gcnt}{\thegc\stepcounter{gc}}
\begin{table}[H]
    \centering
    \begin{tabular}{|l|p{0.9\linewidth}|}
     \hline
     \textbf{Goal} & \textbf{Description} \\
     \hline
     G\gcnt & The EVD is able to identify the charging stations nearby \\
     \hline
     G\gcnt & The EVD is able to visualize the tariffs of the charging stations \\
     \hline
     G\gcnt & The EVD is able to visualize any special offer available at the charging station \\
     \hline
     G\gcnt & The EVD is able to book a charge in a specific charging station for a certain time frame\\
     \hline
     G\gcnt & The EVD is able to start the charging process at a certain station \\
     \hline
     G\gcnt & The EVD is able to pay for the obtained service \\
     \hline
     G\gcnt & The EVD can manage his bookings and charging sessions \\
     \hline
     G\gcnt & The EVD can manage and modify his account details (personal data and EVs information \\
     \hline
     G\gcnt & The CPO can decide from which DSO to acquire energy \\
     \hline 
     G\gcnt & The CPO can decide the cost of charging \\
     \hline 
     G\gcnt & The CPO can set special offers \\
     \hline 
     G\gcnt & The CPO can decide whether to store or not energy in batteries \\
     \hline 
     G\gcnt & The CPO can decide whether to use the energy available in the batteries \\
     \hline 
     G\gcnt & The CPO can manage the charging stations' daily operations\\
     \hline
\end{tabular}
    \caption{Goals}
    \label{tab:Goals}
\end{table}

\section{Scope}
\label{sec:Scope}%
\paragraph{World phenomena} The portion of the real world where the machine is to be deployed and used is called the environment. Hence, scoping the problem by defining the environment is paramount, and this is the target of the next table. With the world phenomena we define the environment in which the software to be will operate, by clarifying some facts about the world and the users. In the following chapter, to the environment will be also given some boundaries, making some assumptions and describing some domains properties, but this is not an aspect tackled by the next table of phenomena.
\newcounter{wp}
\setcounter{wp}{1}
\newcommand{\wpcount}{\thewp\stepcounter{wp}}
\begin{center}
    \begin{longtable}{|l|p{0.725\linewidth}|}
     \hline
     \textbf{World phenomena} & \textbf{Description} \\
     \hline
     WP\wpcount & The EVD wants to charge the EV's battery \\
     \hline
     WP\wpcount & The EVD wants to plan where and when to charge the EV's battery, so he needs to know the position on the territory of the charging stations and if there are available and compatible charging points\\
     \hline
     WP\wpcount & The EVD wants to know the price and any special offers of the charging stations, to choose the one that better suits his needs \\
     \hline
     WP\wpcount & The prices of energy often vary in real world economy \\ 
     \hline
     WP\wpcount & The DSOs, as marketing strategy, have special offers during certain time periods.\\
     \hline
     WP\wpcount & The DSOs provide energy to the charging stations \\
     \hline
     WP\wpcount & The DSOs decide the energy price\\
     \hline
     WP\wpcount & The providers of the charging service (CPOs) make special offers during certain time periods\\
     \hline
     WP\wpcount & The CPOs decide the price of charging, following marketing trends, and depending on DSOs prices and business decisions\\
     \hline
     WP\wpcount & EVs may have an integrated rectifier that converts AC electricity to DC \\
     \hline
     WP\wpcount & Some type of chargers have an integrated rectifier that converts AC electricity to DC. They supply the EV directly with DC current \\
     \hline
     WP\wpcount & A charging of type X, provides electricity in mode C and is given through Z connectors \\
     \hline
     WP\wpcount & A charging station is owned and managed by one CPO \\
     \hline
     WP\wpcount & A CPO owns and manages one or more charging stations \\
     \hline
     WP\wpcount & The CPO buys energy from the DSOs\\
     \hline
     WP\wpcount & A charging station may be equipped with batteries \\
     \hline
     WP\wpcount & Charging stations equipped with batteries grant more flexibility to CPOs on how to choose between the energy stored in the batteries and the one offered by DSOs \\
     \hline
     WP\wpcount & Low voltage (3.7 - 11 kW) chargers need more time to charge the battery \\
     \hline
     WP\wpcount & Medium voltage (22-90 kW) chargers need less time to recharge a battery of capacity C than a low voltage charger \\
     \hline
     WP\wpcount & High voltage (> 90 kW) chargers need less time to recharge a battery of capacity C than a medium voltage charger \\
     \hline
     WP\wpcount & Batteries can only be charged with direct current (DC) electric power \\
     \hline
     WP\wpcount & Given a continuous supply of power W, and a battery with finite capacity C, than the charging time T is finite. \\
     \hline
     WP\wpcount & A battery can store a finite amount of energy, given by its capacity C. \\
     \hline
     WP\wpcount & The charging point of a specific charging station may be unusable because of maintenance or faults \\
     \hline
     WP\wpcount & The DSOs distribute and manage energy from the generation sources\\
     \hline
     WP\wpcount & Most electricity is delivered from the power grid as alternating current (AC) \\
     \hline
     WP\wpcount & During the day the electric power supplied to the station can vary\\
     \hline
     WP\wpcount & During the day a short-duration reduction in the voltage supplied to the electrical power systems may occur due to high current demand or faults in the system.\\
     \hline
     WP\wpcount & During the day a momentary increase in voltage may occur. This may happen when a heavy load turns off in a power system.\\
     \hline
     WP\wpcount & The DSOs operate and manage the electricity distribution networks\\ 
     \hline
     WP\wpcount & The DSOs solve grid problems, such as faults and network breaks\\
     \hline
     WP\wpcount & The DSOs use smart meters to detect interruptions and restore the supply of energy \\
     \hline
    \caption{World Phenomena}
    \label{tab:World Phenomena}
    \end{longtable}
\end{center}

\paragraph{Shared phenomena} The shared phenomena define the interface through which the machine interacts with the world. The software monitors some shared phenomena, while controls others, and to show when the software takes the part of the controller and when the part of the observer we created two more columns in the next table, to keep track of the initiator of the action, in case the natural language turns out to be ambiguous. So, in the following assertions we present an interaction between the world (users and external systems) and the machine (the eMall, especially its interfaces, such as the eMma, the eMci and the managerial web application).

\newcounter{sp}
\setcounter{sp}{1}
\newcommand{\spcount}{\thesp\stepcounter{sp}}
\begin{center}
    %\centering
    \begin{longtable}[H]{|p{0.15\linewidth}|p{0.41\linewidth}|p{0.15\linewidth}|l|}
     \hline
     \textbf{Shared phenomena} & \textbf{Description} & \textbf{Controller} & \textbf{Observer} \\
     \hline
     SP\spcount & The eMma notifies the EVD when the charging process is finished & eMma & EVD\\
     \hline
     SP\spcount & The EVD creates an account & EVD & eMma\\
     \hline
     SP\spcount & The EVD in order to register inserts in the eMma the personal data (name, surname, email, password, payment details) & EVD & eMma \\
     \hline
     SP\spcount & The EVD logs in using the email and the password & EVD & eMma\\
     \hline
     SP\spcount & The EVD accepts the terms of service in order to use the eMma & EVD & eMma\\
     \hline
     SP\spcount & The EVD shares its location with the eMma & EVD & eMma\\
     \hline
     SP\spcount & The EVD confirms the payment from the eMma & EVD & eMma \\
     \hline
     SP\spcount & The EVD deletes previously inserted EVs from its account & EVD & eMma\\
     \hline
     SP\spcount & The EVD updates the specifications of the EVs on its account & EVD & eMma \\
     \hline
     SP\spcount & The EVD adds a new EV to its account & EVD & eMma \\
     \hline
     SP\spcount & The EVD updates personal data on its profile (such as email, payment) & EVD & eMma \\
     \hline
     SP\spcount & The EVD inserts the maximum and minimum current supported by the EV & EVD & eMma \\
     \hline
     SP\spcount & The EVD inserts the maximum power supported by the EV & EVD & eMma \\
     \hline
     SP\spcount & The EVD inserts the inlet type of the EV & EVD & eMma \\
     \hline
     SP\spcount & The EVD inserts whether the EV is equipped with a built-in rectifier & EVD & eMma \\
     \hline
     SP\spcount & The EVD inserts the capacity of the battery in kWh & EVD & eMma \\
     \hline
     SP\spcount & The eMma shows to the EVD the map of the charging stations nearby his location & eMma & EVD \\
     \hline
     SP\spcount & The EVD chooses a charging station from the map & EVD & eMma \\
     \hline
     SP\spcount & The eMall shows the user the rating of the charging station & eMma & EVD \\
     \hline
     SP\spcount & The EVD inserts the expected time when he plans to start the charging process & EVD & eMma \\
     \hline
     SP\spcount & The EVD inserts the expected time when he plans to end the charging process & EVD & eMma \\
     \hline
     SP\spcount & The eMall shows to the EVD the list of available chargers of the charging station & eMma & EVD \\
     \hline
     SP\spcount & The eMall shows the charger type and its connectors  & eMci / eMma & EVD  \\
     \hline
     SP\spcount & The EVD chooses the charger he wants to use from the list of available ones & EVD & eMma \\
     \hline
     SP\spcount & The eMall shows to the EVD the charger costs (per kWh, per minute, additional costs) & eMma/eMci & EVD \\
     \hline
     SP\spcount & The eMci shows to the EVD the status of the charger & eMci & EVD \\
     \hline
     SP\spcount & The eMci shows to the EVD the battery level of the connected EV & eMci / eMma & EVD \\
     \hline
     SP\spcount & During the charging session the eMall shows to the EVD the power output of the charger & eMci & EVD \\
     \hline
     SP\spcount & During the charging session the eMall shows to the EVD the remaining time to complete the charging process & eMci / eMma & EVD \\
     \hline
     SP\spcount & The EVD starts the charging session from the charger & EVD & eMSP\\
     \hline
     SP\spcount & The CPMS asks the DSO about the current available energy sources, their prices, and special offers & CPMS & DSO \\
     \hline
     SP\spcount & The DSO dynamically changes the price of electricity & DSO & CPMS \\
     \hline
     SP\spcount & The DSO changes dynamically the \textit{energy sources} from which acquires energy & DSO & CPMS \\
     \hline
     SP\spcount & The DSO makes special offers & DSO & CPMS \\
     \hline
     SP\spcount & The CPO logs in & CPO & CPMS \\
     \hline
     SP\spcount & The CPO selects the charging station for which to set the parameters (price, energy) of the charging service & CPO & CPMS \\
     \hline
     SP\spcount & The CPO selects the DSO from which to acquire energy & CPO & CPMS \\
     \hline
     SP\spcount & The CPMS shows to the CPO the energy sources and the relative current prices and special offers of the DSO & CPMS & DSO \\
     \hline
     SP\spcount & The CPO sets the cost of charging & CPO & CPMS \\
     \hline
      SP\spcount & The CPO can set a special offer & CPO & CPMS \\
     \hline
     SP\spcount & The CPO selects the energy sources from which to acquire energy & CPO & CPMS \\
     \hline
     SP\spcount & The CPMS shows if there are available batteries in the charging station & CPMS & CPO \\
     \hline
     SP\spcount & The CPO selects the battery in which to store energy & CPO & CPMS \\
     \hline
     SP\spcount & The CPO sets the amount of energy to store in the battery & CPO & CPMS \\
     \hline
     SP\spcount & The CPMS dynamically shows to the CPO the number of EVs charging & CPMS & CPO \\
     \hline
     SP\spcount & The CPMS dynamically shows to the CPO the charging stations consumption of energy & CPMS & CPO \\
     \hline
    \caption{Shared Phenomena}
    \label{tab:Shared Phenomena}
    \end{longtable}
\end{center}

\section{Definitions, Acronyms, Abbreviations}
\label{sec:Definitions, Acronyms, Abbreviations}%
\subsection{Abbreviations}
\begin{itemize}
    \item \textbf{eMall}: e-Mobility for all
    \item \textbf{eMma}: e-Mall mobile application
    \item \textbf{eMci}: e-Mall charger interface
    \item \textbf{CPMS}: Charging Point Management System
    \item \textbf{CPO}: Charge Point Operator
    \item \textbf{eMSP}: Electric Mobility Service Providers
    %\item \textbf{DMS}: Distribution Management System
    \item \textbf{DSO}: Distribution System Operator
    \item \textbf{EV}: Electric Vehicle
    \item \textbf{EVD}: Electric Vehicle Driver
    \item \textbf{EVSE}: Electric Vehicle Supply Equipment
    \item \textbf{HV}: High Voltage
    \item \textbf{LV}: Low Voltage
    \item \textbf{MV}: Medium Voltage
    %\item \textbf{SCADA}: Supervisory Control and Data Acquisition
    %\item \textbf{SCM}: Smart Charging Management 
    %\item \textbf{OMS}: Outage Management System
    \item \textbf{AC}: Alternating current
    \item \textbf{DC}: Direct current
\end{itemize}

\subsection{Definitions}
\begin{itemize}
    \item \textbf{DSO}: typically the entity responsible for the operation and management of distribution networks – High, Medium and Low Voltage networks.
    %For this purpose, the DSO typically owns systems such as Supervisory and Control Data Acquisition and Distribution Management System for the monitoring and general overview of the state of the network. It also owns other systems such as the Outage Management System and Work Force Management System (WFMS) for addressing the network operation problems related with the continuity and quality of service.
    \item \textbf{CPO}: entity that technically manages all the EV infrastructure assets, depending of existing country regulation – this role can be assured by the DSO or other entity.
    \item \textbf{eMSP}: is the entity that can explore the economic side of the EV charging infrastructure, namely by selling energy for charging purposes.
    \item \textbf{CPMS}: is a software system that manages the charge point infrastructure – can manage the technical and economic aspects of the charging infrastructures.
    \item  \textbf{EVD}: person or entity who owns an EV car and can use the public or private facilities for charging purposes.
    \item \textbf{EVSE (Electric Vehicle Supply Equipment)}: It is an equipment that is able to charge EV batteries with AC or DC loads and with different rated powers depending on the type of equipment.
    %\item \textbf{Voltage sag}: a short-duration reduction in voltage of an electric power distribution system. It can be caused by high current demand or fault current elsewhere in the system.
    %\item \textbf{Voltage swell}: the opposite of voltage sag. Voltage swell, which is a momentary increase in voltage, happens when a heavy load turns off in a power system.
    \item \textbf{Socket outlet}: the port on the electric vehicle supply equipment (EVSE) that supplies charging power to the vehicle
    \item \textbf{Plug}: the end of the flexible cable that interfaces with the socket outlet on the EVSE.
    \item \textbf{Cable}: a flexible bundle of conductors that connects the EVSE with the electric vehicle
    \item \textbf{Connector}: the end of the flexible cable that interfaces with the vehicle inlet
    \item \textbf{Vehicle inlet}: the port on the electric vehicle that receives charging power
    %\item \textit{Inverter}: It is a power electronic device or circuitry that changes direct current (DC) to alternating current (AC).
    \item \textbf{Rectifier}: an electrical device that converts alternating current (AC) to direct current (DC).
    \item \textbf{eMma}: the eMSP subsystem responsible for the EVD interaction from the mobile app
    \item \textbf{eMci}: the eMSP subsystem responsible for the EVD interaction at the charging point
    \item \textbf{additional costs}: overtime penalty, deposit for unregistered users
    \item \textbf{Status of the charger}: can be free, occupied, booked and in maintenance
    \item \textbf{Smart meter}: is an electronic device that records information such as consumption of electric energy, voltage levels, current, and power factor; allow the reading of energy flow and real-time usage, and consequently permit the identification of interruptions in energy flow
\end{itemize}

\section{Reference Documents}
\label{sec:Reference Documents}%
\begin{itemize}
    \item \verb|IEEE 29148-2018 International Standard - Requirements engineering|: defines the construct of a good requirement and provides attributes and characteristics of requirements; provides also additional guidelines for applying the requirements and requirements-related processes
    \item \verb|RDD| assignment document
    \item \verb|Electric Vehicle CPMS and Secondary Substation Management by F. Campos,| \verb|Efacec, Portugal; L. Marques, Efacec, Portugal and K. Kotsalos,| \verb|Efacec,| \verb|Portugal (15 October 2018)|: used to define the interactions between the different parts of the system and the actors; models the EV public infrastructures, the eMSP, the DSO and the CPMS together with the APIs and protocols that allow their communication
    \item \verb|EV CHARGING: HOW TO TAP IN THE GRID SMARTLY? by Platform |\verb|for|\\\verb|Electromobility| \verb|(May 2022)|: used to understand the environment of the problem and contextualize the analysis
\end{itemize}

\section{Document Structure}
\label{sec:Document Structure}%
This document mainly follows the guidelines of the \verb|IEEE 29148-2018 - International| \verb|Standard - Requirements engineering|, with some changes in the order of the contents. Also in the final part of the document is present an \verb|Alloy| formal analysis of the described model, an additional section with respect to the standard.
The document is composed by the following parts:
\begin{itemize}
    \item An introduction to the domain in which the system will operate (world phenomena) and an initial description of the software to be, the eMall, specifying the goals to achieve
    \item The overall description of the functions that the eMall has to implement specifying the requirements and a domain model, its interaction with the different users describing with diagrams the most important shared phenomena, and the domain assumptions necessary to the system to be
    \item A thorough list of requirements both functional and non functional: giving a detailed description of the functional requirements using use cases, use cases diagrams and UML sequence diagrams to better specify the interactions; and characterizing the non functional requirements through software system attributes
    \item A formal analysis using alloy in order to show the soundness and correctness of the model described in the document, considering only a part the most important requirements of the system
    \item A section that contains the effort spent by the members of the group working towards the completion of this document
\end{itemize}
